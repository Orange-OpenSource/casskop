apiVersion: kuttl.dev/v1beta1
kind: TestAssert
timeout: 500
commands:
  - script: "kubectl get pods -n $NAMESPACE -o json | jq 'if(.items|length) != 5 then halt_error(-2) else \"OK\" end' 2> /dev/null"
  - script: "kubectl get pods -n $NAMESPACE -o json | jq 'if .items[].status.containerStatuses[].restartCount != 0 then halt_error(-2) else \"OK\" end' 2> /dev/null"
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: cassandra-e2e-dc1-rack1
status:
  currentReplicas: 1
  replicas: 1
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: cassandra-e2e-dc2-rack1
status:
  currentReplicas: 1
  replicas: 1
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: cassandra-e2e-dc1-rack2
status:
  currentReplicas: 1
  replicas: 1
---
apiVersion: db.orange.com/v1alpha1
kind: CassandraCluster
metadata:
  name: cassandra-e2e
status:
  lastClusterAction: Initializing
  lastClusterActionStatus: Done
  phase: Running

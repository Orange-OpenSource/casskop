<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70dece09e">
<link rel="search" type="application/opensearchdescription+xml" title="CassKop" href="/casskop/opensearch.xml"><title data-react-helmet="true">Developer guide | CassKop</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Developer guide | CassKop"><meta data-react-helmet="true" name="description" content="CircleCI build pipeline"><meta data-react-helmet="true" property="og:description" content="CircleCI build pipeline"><meta data-react-helmet="true" property="og:url" content="https://orange-opensource.github.io/casskop/docs/8_contributing/1_developer_guide"><link data-react-helmet="true" rel="shortcut icon" href="/casskop/img/casskop.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://orange-opensource.github.io/casskop/docs/8_contributing/1_developer_guide"><link rel="stylesheet" href="/casskop/styles.f2c05978.css">
<link rel="preload" href="/casskop/styles.e109d7ba.js" as="script">
<link rel="preload" href="/casskop/runtime~main.8734032c.js" as="script">
<link rel="preload" href="/casskop/main.0dba0698.js" as="script">
<link rel="preload" href="/casskop/1.609d1f21.js" as="script">
<link rel="preload" href="/casskop/2.9fbf0449.js" as="script">
<link rel="preload" href="/casskop/67.98ba5add.js" as="script">
<link rel="preload" href="/casskop/70.177fd3ba.js" as="script">
<link rel="preload" href="/casskop/935f2afb.fcfa68e0.js" as="script">
<link rel="preload" href="/casskop/17896441.6be1b574.js" as="script">
<link rel="preload" href="/casskop/069068bf.a7c0c239.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/casskop/"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CassKop</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/casskop/docs/1_concepts/1_introduction">Docs</a><a class="navbar__item navbar__link" href="/casskop/blog">Blog</a><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/casskop/"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CassKop</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/1_concepts/1_introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/1_concepts/1_introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/1_concepts/2_features">Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/1_concepts/3_design_principes">Design Principes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/1_concepts/4_roadmap">Roadmap</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/1_getting_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/2_install_plugin">Install Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/3_multi_casskop">Multi-CassKop</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Platform Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/2_platform_setup/1_gke">Google Kubernetes Engine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/2_platform_setup/2_minikube">MiniKube</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/3_configuration_deployment/1_customizable_install_with_helm">Customizable install with Helm</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/3_configuration_deployment/2_cassandra_cluster">Cassandra Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/3_configuration_deployment/3_storage">Storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/3_configuration_deployment/4_cluster_topology">Cluster topology</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/3_configuration_deployment/2_cassandra_configuration">Cassandra Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/3_configuration_deployment/5_sidecars">Sidecars</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/3_configuration_deployment/9_advanced_configuration">Advanced Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/3_configuration_deployment/10_nodes_management">Nodes Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/3_configuration_deployment/11_cassandra_cluster_status">CassandraCluster Status</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Operations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/0_implementation_architecture">Implementation architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/1_cluster_operations">Cluster Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/2_pods_operations">Pods Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/3_multi_casskop">Multi-CassKop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/3_5_backup_restore">Backup and restore</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/4_upgrade_operator">Upgrade Operator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/5_upgrade_bootstrap_image">Upgrade Bootstrap Image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/6_uninstall_casskop">Uninstall Casskop</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/1_cassandra_cluster">Cassandra cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/2_topology">Topology</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/3_cassandra_cluster_status">Cassandra cluster Status</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/4_multicasskop">MultiCasskop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/5_cassandra_backup">Cassandra backup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/6_cassandra_restore">Cassandra restore</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/7_troubleshooting/1_operations_issues">Operations Issues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/7_troubleshooting/2_gke_issues">GKE Issues</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Contributing</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/casskop/docs/8_contributing/1_developer_guide">Developer guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/8_contributing/2_release_guide">Release guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/8_contributing/3_reporting_bugs">Reporting bugs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/8_contributing/4_credits">Credits</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Developer guide</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="circleci-build-pipeline"></a>CircleCI build pipeline<a class="hash-link" href="#circleci-build-pipeline" title="Direct link to heading">#</a></h2><p>We use CircleCI to build and test the operator code on each commit.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="circleci-config-validation-hook"></a>CircleCI config validation hook<a class="hash-link" href="#circleci-config-validation-hook" title="Direct link to heading">#</a></h3><p>To discover errors in the CircleCI earlier, we can uses the <a href="https://circleci.com/docs/2.0/local-cli/" target="_blank" rel="noopener noreferrer">CircleCI cli</a>
to validate the config file on pre-commit git hook.</p><p>Fisrt you must install the cli, then to install the hook, runs:&lt;</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-console codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cp tools/pre-commit .git/hooks/pre-commit</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The Pipeline uses some envirenment variables that you need to set-up if you want your fork to build</p><ul><li>DOCKER_REPO_BASE -- name of your docker base reposirory (ex: orangeopensource)</li><li>DOCKERHUB_PASSWORD</li><li>DOCKERHUB_USER- SONAR_PROJECT</li><li>SONAR_TOKEN</li></ul><p>If not set in CircleCI environment, according steps will be ignored.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="circleci-on-pr"></a>CircleCI on PR<a class="hash-link" href="#circleci-on-pr" title="Direct link to heading">#</a></h3><p>When you submit a Pull Request, then CircleCI will trigger build pipeline.
Since this is pushed from a fork, for security reason the pipeline won&#x27;t have access to the environment secrets,
and not all steps could be executed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="operator-sdk"></a>Operator SDK<a class="hash-link" href="#operator-sdk" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h3><p>Casskop has been validated with :</p><ul><li><a href="https://golang.github.io/dep/" target="_blank" rel="noopener noreferrer">dep</a> version v0.5.1+.</li><li><a href="https://golang.org" target="_blank" rel="noopener noreferrer">go</a> version v1.13+.</li><li><a href="https://www.docker.com" target="_blank" rel="noopener noreferrer">docker</a> version 18.09+.</li><li><a href="https://kubernetes.io/fr/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">kubectl</a> version v1.13.3+.</li><li><a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a> version v.3.</li><li>Fork from <a href="https://github.com/operator-framework/operator-sdk" target="_blank" rel="noopener noreferrer">Operator sdk</a> version v0.18.0 : <a href="https://github.com/erdrix/operator-sdk/tree/v0.18.0-forked-pr317" target="_blank" rel="noopener noreferrer">Operator sdk - forked</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="install-the-operator-sdk-cli"></a>Install the Operator SDK CLI<a class="hash-link" href="#install-the-operator-sdk-cli" title="Direct link to heading">#</a></h3><p>First, checkout and install the operator-sdk CLI:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ mkdir -p $GOPATH/src/github.com/operator-framework/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd $GOPATH/src/github.com/operator-framework/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">git clone -b v0.18.0-forked-pr317 --single-branch git@github.com:erdrix/operator-sdk.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make tidy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make install</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Note :</strong> Use fork from operator-sdk, waiting for <a href="https://github.com/kubernetes-sigs/controller-tools/pull/317/files#diff-8963ad7c8dcbe3931bc61c3e2954ccf2R300-R301" target="_blank" rel="noopener noreferrer">PR #317</a> to be merged.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="initial-setup"></a>Initial setup<a class="hash-link" href="#initial-setup" title="Direct link to heading">#</a></h3><p>Checkout the project.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ git clone https://github.com/Orange-OpenSource/casskop.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd casskop</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="local-kubernetes-setup"></a>Local kubernetes setup<a class="hash-link" href="#local-kubernetes-setup" title="Direct link to heading">#</a></h3><p>We use <a href="https://kind.sigs.k8s.io" target="_blank" rel="noopener noreferrer">kind</a> in order to run a local kubernetes cluster with the version we chose. We think it deserves some words as it&#x27;s pretty useful and simple to use to test one version or another</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="install"></a>Install<a class="hash-link" href="#install" title="Direct link to heading">#</a></h4><p>The following requires kubens to be present. On MacOs it can be installed using brew :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">brew install kubectx</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The installation of kind is then done with (outside of the cassandra operator folder if you want it to run fast) :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ GO111MODULE=&quot;on&quot; go get sigs.k8s.io/kind@v0.5.1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="setup"></a>Setup<a class="hash-link" href="#setup" title="Direct link to heading">#</a></h4><p>The following actions should be run only to create a new kubernetes cluster.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ samples/kind/create-kind-cluster.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>or if you want to enable network policies</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ samples/kind/create-kind-cluster-network-policies.sh</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>It creates namespace cassandra-e2e by default. If a different namespace is needed it can be specified on the setup-requirements call</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ samples/kind/setup-requirements.sh other-namespace</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To interact with the cluster you then need to use the generated kubeconfig file :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ export KUBECONFIG=$(kind get kubeconfig-path --name=kind)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Before using that newly created cluster, it&#x27;s better to wait for all pods to be running by continously checking their status :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pod --all-namespaces -w</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pauseunpause-the-cluster"></a>Pause/Unpause the cluster<a class="hash-link" href="#pauseunpause-the-cluster" title="Direct link to heading">#</a></h4><p>In order to kinda freeze the cluster because you need to do something else on your laptop, you can use those two aliases. Just put them in your ~/.bashrc or ~/.zshrc :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">alias kpause=&#x27;kind get nodes|xargs docker pause&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">alias kunpause=&#x27;kind get nodes|xargs docker unpause&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="delete-cluster"></a>Delete cluster<a class="hash-link" href="#delete-cluster" title="Direct link to heading">#</a></h4><p>The simple command <code>kind delete cluster</code> takes care of it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="build-casskop"></a>Build CassKop<a class="hash-link" href="#build-casskop" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="using-your-local-environment"></a>Using your local environment<a class="hash-link" href="#using-your-local-environment" title="Direct link to heading">#</a></h4><p>If you prefer working directly with your local go environment you can simply uses :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make get-deps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make build</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><blockquote><p>You can check on the Gitlab Pipeline to see how the Project is build and test for each push</p></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="or-using-the-provided-cross-platform-build-environment"></a>Or Using the provided cross platform build environment<a class="hash-link" href="#or-using-the-provided-cross-platform-build-environment" title="Direct link to heading">#</a></h4><p>Build the docker image which will be used to build CassKop docker image</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make build-ci-image</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><blockquote><p>If you want to change the operator-sdk version change the <strong>OPERATOR_SDK_VERSION</strong> in the Makefile.</p></blockquote><p>Then build CassKop (code &amp; image)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make docker-get-deps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make docker-build</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="run-casskop"></a>Run CassKop<a class="hash-link" href="#run-casskop" title="Direct link to heading">#</a></h3><p>We can quickly run CassKop in development mode (on your local host), then it will use your kubectl configuration file to connect to your kubernetes cluster.</p><p>There are several ways to execute your operator :</p><ul><li>Using your IDE directly</li><li>Executing directly the Go binary</li><li>deploying using the Helm charts</li></ul><p>If you want to configure your development IDE, you need to give it environment variables so that it will uses to connect to kubernetes.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">KUBECONFIG=&lt;path/to/your/kubeconfig&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WATCH_NAMESPACE=&lt;namespace_to_watch&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">POD_NAME=&lt;name for operator pod&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LOG_LEVEL=Debug</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">OPERATOR_NAME=ide</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="run-the-operator-locally-with-the-go-binary"></a>Run the Operator Locally with the Go Binary<a class="hash-link" href="#run-the-operator-locally-with-the-go-binary" title="Direct link to heading">#</a></h4><p>This method can be used to run the operator locally outside of the cluster. This method may be preferred during development as it facilitates faster deployment and testing.</p><p>Set the name of the operator in an environment variable</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ export OPERATOR_NAME=cassandra-operator</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Deploy the CRD</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f deploy/crds/db.orange.com_cassandraclusters_crd.yaml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make run</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will run the operator in the <code>default</code> namespace using the default Kubernetes config file at <code>$HOME/.kube/config</code>.</p><p><strong>Note:</strong> JMX operations cannot be executed on Cassandra nodes when running the operator locally. This is because the operator makes JMX calls over HTTP using jolokia and when running locally the operator is on a different network than the Cassandra cluster.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deploy-using-the-helm-charts"></a>Deploy using the Helm Charts<a class="hash-link" href="#deploy-using-the-helm-charts" title="Direct link to heading">#</a></h4><p>This section provides an instructions for running the operator Helm charts with an image that is built from the local branch.</p><p>Build the image from the current branch.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ export DOCKER_REPO_BASE=&lt;your-docker-repo&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make docker-build</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Push the image to docker hub (or to whichever repo you want to use)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make push</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Note:</strong> In this example we are pushing to docker hub.</p><p><strong>Note:</strong> The image tag is a combination of the version as defined in <code>verion/version.go</code> and the branch name.</p><p>Install the Helm chart.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm install ./helm/cassandra-operator \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set-string image.repository=orangeopensource/casskop,image.tag=0.4.0-local-dev-helm \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name local-dev-helm</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Note:</strong> The <code>image.repository</code> and <code>image.tag</code> template variables have to match the names from the image that we pushed in the previous step.</p><p><strong>Note:</strong> We set the chart name to the branch, but it can be anything.</p><p>Lastly, verify that the operator is running.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                                READY   STATUS    RESTARTS   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">local-dev-helm-cassandra-operator-8946b89dc-4cfs9   1/1     Running   0          7m45s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="run-unit-tests"></a>Run unit-tests<a class="hash-link" href="#run-unit-tests" title="Direct link to heading">#</a></h3><p>You can run Unit-test for CassKop</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make unit-test</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="run-e2e-end-to-end-tests"></a>Run e2e end to end tests<a class="hash-link" href="#run-e2e-end-to-end-tests" title="Direct link to heading">#</a></h3><p>CassKop also have several end-to-end tests that can be run using makefile.</p><p>You need to create the namespace <code>cassandra-e2e</code> before running the tests.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create namespace cassandra-e2e</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>to launch different tests in parallel in different temporary namespaces</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make e2e</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>or sequentially in the namespace <code>cassandra-e2e</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make e2e-test-fix</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Note</strong>: <code>make e2e</code> executes all tests in different, temporary namespaces in parallel. Your k8s cluster will need a lot of resources to handle the many Cassandra nodes that launch in parallel. </p><p><strong>Note</strong>: <code>make e2e-test-fix</code> executes all tests serially in the <code>cassandra-e2e</code> namespace and as such does not require as many k8s resources as <code>make e2e</code> does, but overall execution will be slower.</p><p>You can choose to run only 1 test using the args ex:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make e2e-test-fix-arg ClusterScaleDown</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Tip</strong>: When debugging test failures, you can run <code>kubectl get events --all-namespaces</code> which produce output like:</p><p><code>cassandracluster-group-clusterscaledown-1561640024   0s    Warning   FailedScheduling   Pod   0/4 nodes are available: 1 node(s) had taints that the pod didn&#x27;t tolerate, 3 Insufficient cpu.</code></p><p><strong>Tip</strong>: When tests fail, there may be resources that need to be cleaned up. Run <code>tools/e2e_test_cleanup.sh</code> to delete resources left over from tests.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="run-kuttl-tests"></a>Run kuttl tests<a class="hash-link" href="#run-kuttl-tests" title="Direct link to heading">#</a></h3><p>This requires <a href="https://kuttl.dev/docs/cli.html#setup-the-kuttl-kubectl-plugin" target="_blank" rel="noopener noreferrer">kuttl cli</a> to be installed on your machine</p><p>You first need to have a Kubernetes cluster set up with kubectl.</p><p>Then to run all tests you can simply type :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl kuttl test --config ./test/e2e/kuttl/kuttl-test.yaml ./test/e2e/kuttl/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will run all testcases in the <code>/test/e2e/kuttl/</code> directory in parallel on different generated namespaces (with Casskop automatically installed on each).</p><blockquote><p>If you installed only the binary of kuttl, you can omit the <code>kubectl</code> at the beginning</p></blockquote><p><strong>Tip</strong>: You can specify a single test case to run by adding <code>--test TestCase</code> where <code>TestCase</code> is the name of one of the directories in <code>/test/e2e/kuttl/*here*</code> (like <code>ScaleUpAndDown</code> for example)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="debug-casskop-in-remote-in-a-kubernetes-cluster"></a>Debug CassKop in remote in a Kubernetes cluster<a class="hash-link" href="#debug-casskop-in-remote-in-a-kubernetes-cluster" title="Direct link to heading">#</a></h3><p>CassKop makes some specific calls to the Jolokia API of the CassandraNodes it deploys inside the kubernetes
cluster. Because of this, it is not possible to fully debug CassKop when launch outside the kubernetes cluster (in
your local IDE).</p><p>It is possible to use external solutions such as KubeSquash or Telepresence.</p><p>Telepresence launch a bi-directional tunnel between your dev environment and an existing operator pod in the cluster
which it will <strong>swap</strong></p><p>To launch the telepresence utility you can launch</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make telepresence</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><blockquote><p>You need to install it before see : <a href="https://www.telepresence.io/" target="_blank" rel="noopener noreferrer">https://www.telepresence.io/</a></p></blockquote><p>If your cluster don&#x27;t have Internet access, you can change the telepresence image to use to one your cluster have access
exemple:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">TELEPRESENCE_REGISTRY=you-private-registry/datawire  make debug-telepresence-with-alias</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configure-the-ide"></a>Configure the IDE<a class="hash-link" href="#configure-the-ide" title="Direct link to heading">#</a></h4><p>Now we just need to configure the IDE :</p><p><img src="/casskop/assets/images/ide_debug_configutation-8526080b8539923c9ccd9d8e3e2738ca.png"></p><p>and let&#x27;s the magic happened</p><p><img src="/casskop/assets/images/ide_debug_action-03ad1d55c293740efc5e4f3773c2e809.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="build-multi-casskop"></a>Build Multi-CassKop<a class="hash-link" href="#build-multi-casskop" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="using-your-docker-environment"></a>Using your docker environment<a class="hash-link" href="#using-your-docker-environment" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd $(git rev-parse --show-toplevel)/multi-casskop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make docker-build</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="run-multi-casskop"></a>Run Multi-CassKop<a class="hash-link" href="#run-multi-casskop" title="Direct link to heading">#</a></h3><p>We can quickly setup a k3d cluster with casskop and multi-casskop to test a PR on multi-casskop. </p><ul><li>[Build your multi-casskop docker image](#### Using your docker environment) which should print</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Generate zzz-deepcopy objects&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Generate zzz-deepcopy objects</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully built bf57e90615bb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully tagged orangeopensource/multi-casskop:0.5.6-my-pr</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>Create a k3 cluster with 2 namespaces and install casskop</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">k3d cluster create multi-casskop-qa</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd $(git rev-parse --show-toplevel)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl  apply -f deploy/crds/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl  create namespace cluster1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl  create namespace cluster2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">helm install casskop -n cluster1 orange-incubator/cassandra-operator --set debug.enabled=true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">helm install casskop -n cluster2 orange-incubator/cassandra-operator --set debug.enabled=true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubemcsa export --context=k3d-multi-casskop-qa cassandra-operator --as k8s-cluster2 -n cluster1 | k apply -n cluster1 -f -</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>Update generated secret to use <code>server: https://kubernetes.default.svc/</code> in its config (We won&#x27;t need that method
anymore and will be able to create 2 different clusters when <a href="https://github.com/rancher/k3d/issues/101" target="_blank" rel="noopener noreferrer">https://github.com/rancher/k3d/issues/101</a> is solved)</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl  get secrets -n cluster1 k8s-cluster2 -o json|jq -r &#x27;.data.config&#x27;|base64 -d|pbcopy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># set server to https://kubernetes.default.svc in the output, then copy it in the clipboard and run</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pbpaste|base64 -w10000|pbcopy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># You now have to edit the secret and replace config&#x27;s value by what you have in your clipboard</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>load the docker image you built in the first step into your k3d cluster</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">k3d image import orangeopensource/multi-casskop:0.5.6-my-pr -c multi-casskop-qa</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] Loading images into &#x27;multi-casskop-qa&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] Starting k3d-tools node...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] Saving 1 image(s) from runtime...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0004] Importing images into nodes...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0004] Importing images from tarball &#x27;/k3d/images/k3d-multi-casskop-qa-images-20200929124019.tar&#x27; into node &#x27;k3d-multi-casskop-qa-server-0&#x27;...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0006] Removing the tarball(s) from image volume...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0007] Removing k3d-tools node...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0008] Deleted k3d-multi-casskop-qa-tools</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0008] Successfully imported image(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0008] DONE</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>Install multi-casskop using the image you just imported</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">helm install multi-casskop orange-incubator/multi-casskop --set k8s.local=k3d-multi-casskop-qa \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set k8s.remote={k8s-cluster2} --set image.tag=0.5.6-my-pr --set debug.enabled=true -n cluster1 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set image.pullPolicy=IfNotPresent</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-this-repository-was-initially-build"></a>How this repository was initially build<a class="hash-link" href="#how-this-repository-was-initially-build" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="boilerplate-casskop"></a>Boilerplate CassKop<a class="hash-link" href="#boilerplate-casskop" title="Direct link to heading">#</a></h3><p>We used the SDK to create the repository layout. This command is for memory ;) (or for applying sdk upgrades)</p><blockquote><p>You need to have first install the SDK.</p></blockquote><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#old version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> operator-sdk new casskop --api-version=db.orange.com/v1alpha1 --kind=CassandraCluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#new version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">operator-sdk new casskop --dep-manager=modules --repo=github.com.Orange-OpenSource/casskop --type=go</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Then you want to add managers:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Add a new API for the custom resource CassandraCluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ operator-sdk add api --api-version=db.orange.com/v1alpha1 --kind=CassandraCluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Add a new controller that watches for CassandraCluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ operator-sdk add controller --api-version=db.orange.com/v1alpha1 --kind=CassandraCluster</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="useful-infos-for-developers"></a>Useful Infos for developers<a class="hash-link" href="#useful-infos-for-developers" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="parsing-yaml-from-string"></a>Parsing Yaml from String<a class="hash-link" href="#parsing-yaml-from-string" title="Direct link to heading">#</a></h4><p>For parsing Yaml from string to Go Object we uses this library : <code>github.com/ghodss/yaml</code> because with the official one
not all fields of the yaml where correctly populated. I don&#x27;t know why..</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Orange-OpenSource/casskop/edit/master/website/docs/8_contributing/1_developer_guide.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/casskop/docs/7_troubleshooting/2_gke_issues"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« GKE Issues</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/casskop/docs/8_contributing/2_release_guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Release guide Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#circleci-build-pipeline" class="table-of-contents__link">CircleCI build pipeline</a><ul><li><a href="#circleci-config-validation-hook" class="table-of-contents__link">CircleCI config validation hook</a></li><li><a href="#circleci-on-pr" class="table-of-contents__link">CircleCI on PR</a></li></ul></li><li><a href="#operator-sdk" class="table-of-contents__link">Operator SDK</a><ul><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#install-the-operator-sdk-cli" class="table-of-contents__link">Install the Operator SDK CLI</a></li><li><a href="#initial-setup" class="table-of-contents__link">Initial setup</a></li><li><a href="#local-kubernetes-setup" class="table-of-contents__link">Local kubernetes setup</a></li><li><a href="#build-casskop" class="table-of-contents__link">Build CassKop</a></li><li><a href="#run-casskop" class="table-of-contents__link">Run CassKop</a></li><li><a href="#run-unit-tests" class="table-of-contents__link">Run unit-tests</a></li><li><a href="#run-e2e-end-to-end-tests" class="table-of-contents__link">Run e2e end to end tests</a></li><li><a href="#run-kuttl-tests" class="table-of-contents__link">Run kuttl tests</a></li><li><a href="#debug-casskop-in-remote-in-a-kubernetes-cluster" class="table-of-contents__link">Debug CassKop in remote in a Kubernetes cluster</a></li><li><a href="#build-multi-casskop" class="table-of-contents__link">Build Multi-CassKop</a></li><li><a href="#run-multi-casskop" class="table-of-contents__link">Run Multi-CassKop</a></li></ul></li><li><a href="#how-this-repository-was-initially-build" class="table-of-contents__link">How this repository was initially build</a><ul><li><a href="#boilerplate-casskop" class="table-of-contents__link">Boilerplate CassKop</a></li><li><a href="#useful-infos-for-developers" class="table-of-contents__link">Useful Infos for developers</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Getting Started</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/casskop/docs/1_concepts/1_introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://casskop.slack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a class="footer__link-item" href="/casskop/blog">Blog</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contact</h4><ul class="footer__items"><li class="footer__item"><a href="mailto:prj.casskop.support@list.orangeportails.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email</a></li><li class="footer__item"><a href="https://github.com/Orange-OpenSource/casskop/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Feature request</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 Orange, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/casskop/styles.e109d7ba.js"></script>
<script src="/casskop/runtime~main.8734032c.js"></script>
<script src="/casskop/main.0dba0698.js"></script>
<script src="/casskop/1.609d1f21.js"></script>
<script src="/casskop/2.9fbf0449.js"></script>
<script src="/casskop/67.98ba5add.js"></script>
<script src="/casskop/70.177fd3ba.js"></script>
<script src="/casskop/935f2afb.fcfa68e0.js"></script>
<script src="/casskop/17896441.6be1b574.js"></script>
<script src="/casskop/069068bf.a7c0c239.js"></script>
</body>
</html>
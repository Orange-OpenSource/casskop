<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70dece09e">
<link rel="search" type="application/opensearchdescription+xml" title="CassKop" href="/casskop/opensearch.xml"><title data-react-helmet="true">Cassandra Configuration | CassKop</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Cassandra Configuration | CassKop"><meta data-react-helmet="true" name="description" content="Cassandra bootstrap"><meta data-react-helmet="true" property="og:description" content="Cassandra bootstrap"><meta data-react-helmet="true" property="og:url" content="https://orange-opensource.github.io/casskop/docs/3_configuration_deployment/2_cassandra_configuration"><link data-react-helmet="true" rel="shortcut icon" href="/casskop/img/casskop.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://orange-opensource.github.io/casskop/docs/3_configuration_deployment/2_cassandra_configuration"><link rel="stylesheet" href="/casskop/styles.f2c05978.css">
<link rel="preload" href="/casskop/styles.e109d7ba.js" as="script">
<link rel="preload" href="/casskop/runtime~main.8734032c.js" as="script">
<link rel="preload" href="/casskop/main.0dba0698.js" as="script">
<link rel="preload" href="/casskop/1.609d1f21.js" as="script">
<link rel="preload" href="/casskop/2.9fbf0449.js" as="script">
<link rel="preload" href="/casskop/67.98ba5add.js" as="script">
<link rel="preload" href="/casskop/70.177fd3ba.js" as="script">
<link rel="preload" href="/casskop/935f2afb.fcfa68e0.js" as="script">
<link rel="preload" href="/casskop/17896441.6be1b574.js" as="script">
<link rel="preload" href="/casskop/83acfb32.3bdc524a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/casskop/"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CassKop</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/casskop/docs/1_concepts/1_introduction">Docs</a><a class="navbar__item navbar__link" href="/casskop/blog">Blog</a><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/casskop/"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CassKop</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/1_concepts/1_introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/1_concepts/1_introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/1_concepts/2_features">Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/1_concepts/3_design_principes">Design Principes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/1_concepts/4_roadmap">Roadmap</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/1_getting_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/2_install_plugin">Install Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/3_multi_casskop">Multi-CassKop</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Platform Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/2_platform_setup/1_gke">Google Kubernetes Engine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/2_setup/2_platform_setup/2_minikube">MiniKube</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Advanced Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/3_configuration_deployment/1_customizable_install_with_helm">Customizable install with Helm</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/3_configuration_deployment/2_cassandra_cluster">Cassandra Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/3_configuration_deployment/3_storage">Storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/3_configuration_deployment/4_cluster_topology">Cluster topology</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/casskop/docs/3_configuration_deployment/2_cassandra_configuration">Cassandra Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/3_configuration_deployment/5_sidecars">Sidecars</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/3_configuration_deployment/9_advanced_configuration">Advanced Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/3_configuration_deployment/10_nodes_management">Nodes Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/3_configuration_deployment/11_cassandra_cluster_status">CassandraCluster Status</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Operations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/0_implementation_architecture">Implementation architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/1_cluster_operations">Cluster Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/2_pods_operations">Pods Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/3_multi_casskop">Multi-CassKop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/3_5_backup_restore">Backup and restore</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/4_upgrade_operator">Upgrade Operator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/5_upgrade_bootstrap_image">Upgrade Bootstrap Image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/5_operations/6_uninstall_casskop">Uninstall Casskop</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/1_cassandra_cluster">Cassandra cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/2_topology">Topology</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/3_cassandra_cluster_status">Cassandra cluster Status</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/4_multicasskop">MultiCasskop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/5_cassandra_backup">Cassandra backup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/6_references/6_cassandra_restore">Cassandra restore</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/7_troubleshooting/1_operations_issues">Operations Issues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/7_troubleshooting/2_gke_issues">GKE Issues</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contributing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/8_contributing/1_developer_guide">Developer guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/8_contributing/2_release_guide">Release guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/8_contributing/3_reporting_bugs">Reporting bugs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/casskop/docs/8_contributing/4_credits">Credits</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Cassandra Configuration</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cassandra-bootstrap"></a>Cassandra bootstrap<a class="hash-link" href="#cassandra-bootstrap" title="Direct link to heading">#</a></h2><p>The configuration of the Cassandra image has been delegated to two init-containers that are executed prior to the Cassandra
container when the pod is started.</p><p>There is a specific bootstrap image that is build from the docker directory and contains all required files or scripts
to work with CassKop.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="initcontainer-1--init-config"></a>Initcontainer 1 : init-config<a class="hash-link" href="#initcontainer-1--init-config" title="Direct link to heading">#</a></h3><p>The init container is responsible for the following actions :</p><ul><li>copy the default Cassandra configuration from user&#x27;s provided Cassandra image.</li></ul><p>Configuration:</p><ul><li>The init-config container is by default the baseImage Cassandra image that can be changed using
<code>Spec.initContainerImage</code>.</li><li>The default command executed by the init-container is:</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> -vr /etc/cassandra/* /bootstrap</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>This command can be changed using  <code>Spec.initContainerCmd</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="initcontainer-2--bootstrap"></a>Initcontainer 2 : bootstrap<a class="hash-link" href="#initcontainer-2--bootstrap" title="Direct link to heading">#</a></h3><p>The bootstrap Container :</p><ul><li>applying files and additional jar from the bootstrap image to the default configuration</li><li>applying the user&#x27;s configmap custom configuration (if any) on top of the default configuration</li><li>modifying the configuration to be suitable to run with Casskop:<ul><li>update cluster name</li><li>configure dc/rack properties</li><li>applying seedlist</li><li>add cassandra exporter and jolokia agent</li><li>..</li></ul></li></ul><p>We provide the bootstrap image, but you can change it using <code>Spec.bootstrapImage</code> but you need to comply with the
required actions, see <a href="https://github.com/Orange-OpenSource/casskop/tree/master/docker/bootstrap" target="_blank" rel="noopener noreferrer">Bootstrap</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="nodes-per-rack"></a>Nodes per rack<a class="hash-link" href="#nodes-per-rack" title="Direct link to heading">#</a></h2><p>One of the requirements for CassKop is to always keep the same number of nodes in each of its racks per Cassandra DCs. The number of nodes used for the Cassandra Cluster is configured using the <code>CassandraCluster.spec.nodesPerRacks</code>
property.</p><blockquote><p>If you have not specify a Cluster Topology, then you&#x27;ll have a default datacenter named <code>dc1</code> and a default rack named
<code>rack1</code></p></blockquote><p>CassKop will keep the same number of nodes in each Cassandra rack as it is a good practice for Cassandra.</p><p>You can define different numbers of replicas for racks in different Cassandra DataCenters using the <code>nodesPerRacks</code> property at the datacenter level. (in <code>CassandraCluster.spec.topology.dc[&lt;idx&gt;].nodesPerRacks</code>). If
specified on the datacenter level, this parameter takes priority over the global <code>CassandraCluster.spec.nodesPerRacks</code>.</p><p>Example:
example to scale up the nodesPerRacks in DC2 :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">topology</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">dc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> dc1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">rack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rack1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rack2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> dc2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">nodesPerRacks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 3        &lt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"> We increase by one this value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">rack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rack1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><blockquote><p>The number of Cassandra nodes will be the multiplication of the number of racks * the nodesPerRacks value.</p></blockquote><p>If we changes on of these properties then CassKop will trigger either a <a href="/casskop/docs/5_operations/1_cluster_operations#scaleup">ScaleUp</a>
or a <a href="/casskop/docs/5_operations/1_cluster_operations#scaledown">ScaleDown</a> operation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configuration-override-using-configmap"></a>Configuration override using configMap<a class="hash-link" href="#configuration-override-using-configmap" title="Direct link to heading">#</a></h2><p>CassKop allows you to customize the configuration of Apache Cassandra nodes by specifying a dedicated <code>ConfigMap</code>
name in the <code>CassandraCluster.spec.configMapName</code> containing configuration files to be overwritten above the default
configuration files of the dedicated Docker Image.</p><p>We have a specific Cassandra Docker image startup script that will overwrite each file in the directory
<code>/etc/cassandra</code>, from the one specified in the configMap if they exist.</p><blockquote><p>You can surcharge any files in the docker image <code>/etc/cassandra</code> with the ConfigMap.</p></blockquote><p>Typical overwriting files may be :</p><ul><li>cassandra.yaml</li><li>jvm.options</li><li>specifying a pre_run.sh script</li></ul><p>See the example below:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ConfigMap</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cassandra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">configmap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">pre_run.sh</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;  ** this is pre_run.sh script executed before run.sh **&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#Examples:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;Change default Authenticator &amp; Authorizer&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    sed </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">ri &#x27;s/(authenticator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">).*/\1 PasswordAuthenticator/&#x27; /etc/cassandra/cassandra.yaml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    sed </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">ri &#x27;s/(authorizer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">).*/\1 CassandraAuthorizer/&#x27; /etc/cassandra/cassandra.yaml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#test &quot;$(hostname)&quot; == &#x27;cassandra-demo-dc1-rack2-0&#x27; &amp;&amp; echo &quot;update param&quot; &amp;&amp; sed -i &#x27;s/windows_timer_interval: 1/windows_timer_interval: 2/&#x27; /etc/cassandra/cassandra.yaml</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#test &quot;$(hostname)&quot; == &#x27;cassandra-demo-dc1-rack3-0&#x27; &amp;&amp; echo &quot;-Dcassandra.replace_address_first_boot=172.31.183.209&quot; &gt; /etc/cassandra/jvm.options</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#test &quot;$(hostname)&quot; == &#x27;cassandra-demo-dc2-rack1-0&#x27; &amp;&amp; echo &quot;-Dcassandra.override_decommission=true&quot; &gt; /etc/cassandra/jvm.options</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;  ** end of pre_run.sh script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> continue with run.sh **&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">post_run.sh</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;Check Configured seeds by bootstrap&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    grep &quot;seeds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">&quot; /etc/cassandra/cassandra.yaml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You can create the ConfigMap above from the repo:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f config/cassandra-configmap-v1.yaml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">configmap </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cassandra-configmap-v1&quot;</span><span class="token plain"> created</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now you can add the <code>configMapName: cassandra-configmap-v1</code> to the Spec section of your CassandraCluster definition
<a href="https://github.com/Orange-OpenSource/casskop/tree/master/samples/cassandracluster.yaml" target="_blank" rel="noopener noreferrer">example</a></p><p>If you edit the ConfigMap it won&#x27;t be detected neither by CassKop nor by the statefulsets/pods (unless you reboot the
pods).
It is recommended for configuration changes, to version the configmap and to create apply new configmap in the CRD, this
will trigger a rollingRestart of the whole cluster applying the new configuration.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>each time you specify a new configMap CassKop will start a <code>rollingUpdate</code> of all nodes
in the cluster. more info on <a href="/casskop/docs/5_operations/1_cluster_operations#updateconfigmap">UpdateConfigMap</a></p></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>At this time CassKop won&#x27;t allow you to specify only excerpt of the configurations files, your
ConfigMap <strong>MUST</strong> contain valid and complete configuration files</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configuration-pre_runsh-script"></a>Configuration pre_run.sh script<a class="hash-link" href="#configuration-pre_runsh-script" title="Direct link to heading">#</a></h3><p>In case you need to make some specific actions on a particular node, such as make use of the <strong>CASSANDRA_REPLACE_NODE</strong>
variable, you can use the pre_run.sh script in the ConfigMap. If present, the cassandra docker will execute this script
prior to the <code>run.sh</code> script from the docker image.</p><p>Example of a configMap with the pre_run.sh script :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ConfigMap</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cassandra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">configmap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">pre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">run</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">pre_run.sh</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;** this is a pre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">scrip for run.sh that can be edit with configmap&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    test &quot;$(hostname)&quot; == &#x27;cassandra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">demo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">dc1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">rack1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">0&#x27; &amp;&amp; export CASSANDRA_REPLACE_NODE=10.233.93.174</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    echo &quot;** end of pre_run.sh script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> continue with run.sh&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>In the case you use the configmap for one-time specific action, don&#x27;t forget to edit again to remove
the specific treatment once it is no more needed.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="jvm-options"></a>JVM options<a class="hash-link" href="#jvm-options" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="memory"></a>Memory<a class="hash-link" href="#memory" title="Direct link to heading">#</a></h3><p>Apache Cassandra is running inside a Java Virtual Machine (JVM). JVM has many configuration options to optimize the
performance for different platforms and architectures.</p><p>CassKop allows configuring these values by adding a <code>jvm.options</code> in the user <code>ConfigMap</code>.</p><p>The default value used for <code>-Xmx</code> depends on whether there is a memory request configured for the container :</p><ul><li><p>If there is a memory request, the JVM&#x27;s maximum memory must be set to a value corresponding to the limit.</p></li><li><p>When there is no memory request, CassKop will limit it to &quot;2048M&quot;.</p></li><li><p>set the memory request and the memory limit to the same value, so that the pod is in guarantee mode</p></li></ul><blockquote><p>CassKop will automatically compute the env var CASSANDRA_MAX_HEAP which is used to define <code>-Xms</code> and <code>-Xmx</code> in the
<code>/run.sh</code> docker image script, from 1/4 of container Memory Limit.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="garbagecollector-output"></a>GarbageCollector output<a class="hash-link" href="#garbagecollector-output" title="Direct link to heading">#</a></h3><p>We have a specific parameter in the CRD <code>spec.gcStdout: true/false</code> which specify if we want to send the JVM garbage collector logs
in the stdout of the container or inside a specific file in the container.</p><p>Default value is true, so it sends GC logs in stdout along with cassandra&#x27;s logs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="authentication-and-authorizations"></a>Authentication and authorizations<a class="hash-link" href="#authentication-and-authorizations" title="Direct link to heading">#</a></h2><p>CassKop uses Jolokia from the cassandra-image to communicate. We can add
authentication on Jolokia by defining a secret :</p><p>Example:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-console codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Secret</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: jolokia-auth</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type: Opaque</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  password: TTBucDQ1NXcwcmQ=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  username: am9sb2tpYS11c2Vy</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>and in the CRD you will define <code>spec.imageJolokiaSecret</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-console codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  imageJolokiaSecret:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: jolokia-auth</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>CassKop will propagate the secrets in Cassandra so that it can configure Jolokia and use it to connect.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Orange-OpenSource/casskop/edit/master/website/docs/3_configuration_deployment/5_cassandra_configuration.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/casskop/docs/3_configuration_deployment/4_cluster_topology"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Cluster topology - Cassandra rack aware deployments</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/casskop/docs/3_configuration_deployment/5_sidecars"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Sidecars Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cassandra-bootstrap" class="table-of-contents__link">Cassandra bootstrap</a><ul><li><a href="#initcontainer-1--init-config" class="table-of-contents__link">Initcontainer 1 : init-config</a></li><li><a href="#initcontainer-2--bootstrap" class="table-of-contents__link">Initcontainer 2 : bootstrap</a></li></ul></li><li><a href="#nodes-per-rack" class="table-of-contents__link">Nodes per rack</a></li><li><a href="#configuration-override-using-configmap" class="table-of-contents__link">Configuration override using configMap</a><ul><li><a href="#configuration-pre_runsh-script" class="table-of-contents__link">Configuration pre_run.sh script</a></li></ul></li><li><a href="#jvm-options" class="table-of-contents__link">JVM options</a><ul><li><a href="#memory" class="table-of-contents__link">Memory</a></li><li><a href="#garbagecollector-output" class="table-of-contents__link">GarbageCollector output</a></li></ul></li><li><a href="#authentication-and-authorizations" class="table-of-contents__link">Authentication and authorizations</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Getting Started</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/casskop/docs/1_concepts/1_introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://casskop.slack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a class="footer__link-item" href="/casskop/blog">Blog</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contact</h4><ul class="footer__items"><li class="footer__item"><a href="mailto:prj.casskop.support@list.orangeportails.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email</a></li><li class="footer__item"><a href="https://github.com/Orange-OpenSource/casskop/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Feature request</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 Orange, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/casskop/styles.e109d7ba.js"></script>
<script src="/casskop/runtime~main.8734032c.js"></script>
<script src="/casskop/main.0dba0698.js"></script>
<script src="/casskop/1.609d1f21.js"></script>
<script src="/casskop/2.9fbf0449.js"></script>
<script src="/casskop/67.98ba5add.js"></script>
<script src="/casskop/70.177fd3ba.js"></script>
<script src="/casskop/935f2afb.fcfa68e0.js"></script>
<script src="/casskop/17896441.6be1b574.js"></script>
<script src="/casskop/83acfb32.3bdc524a.js"></script>
</body>
</html>
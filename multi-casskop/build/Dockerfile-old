FROM service-os-ubuntu-docker.artifactory.si.francetelecom.fr/ubuntu:18.04

RUN test -e /etc/apt/sources.list.d || mkdir -p /etc/apt/sources.list.d && \
    echo "deb https://artifactory.si.francetelecom.fr/pfs-noh_debian_vdc bionic all" > /etc/apt/sources.list.d/noh.list && \
    echo "deb https://artifactory.si.francetelecom.fr/sfy-idem-debian bionic exploit/stable" > /etc/apt/sources.list.d/exploit.list && \
    apt-get update -yq && \
    apt-get install -y --no-install-recommends \
		build-essential \
		ca-certificates \
		hebex-ca-certificates \
	&& \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*


ENV OPERATOR=/usr/local/bin/multi-casskop \
    USER_UID=1001 \
    USER_NAME=multi-casskop

# install operator binary
COPY build/_output/bin/multi-casskop ${OPERATOR}

COPY build/bin /usr/local/bin
RUN  /usr/local/bin/user_setup

ENTRYPOINT ["/usr/local/bin/entrypoint"]

USER ${USER_UID}

<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70dece09e">
<link rel="search" type="application/opensearchdescription+xml" title="CassKop" href="/casskop/opensearch.xml"><title data-react-helmet="true">Posts tagged &quot;sidecars&quot; | CassKop</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;sidecars&quot; | CassKop"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;sidecars&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;sidecars&quot;"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/casskop/img/casskop.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/casskop/styles.f2c05978.css">
<link rel="preload" href="/casskop/styles.e109d7ba.js" as="script">
<link rel="preload" href="/casskop/runtime~main.8734032c.js" as="script">
<link rel="preload" href="/casskop/main.0dba0698.js" as="script">
<link rel="preload" href="/casskop/1.609d1f21.js" as="script">
<link rel="preload" href="/casskop/2.9fbf0449.js" as="script">
<link rel="preload" href="/casskop/3.3079f6c6.js" as="script">
<link rel="preload" href="/casskop/6875c492.674c6f13.js" as="script">
<link rel="preload" href="/casskop/e0f41929.8c9ab0c8.js" as="script">
<link rel="preload" href="/casskop/902ac59e.365b93f1.js" as="script">
<link rel="preload" href="/casskop/6dd645a8.884a5509.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/casskop/"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CassKop</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/casskop/docs/1_concepts/1_introduction">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/casskop/blog">Blog</a><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/casskop/"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">CassKop</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/1_concepts/1_introduction">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/casskop/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/casskop/blog/2020/03/26/dynamics_sidecars_storage">Casskop 0.5.1 - Dynamic sidecars and storage configuration feature</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/casskop/blog/2020/01/15/multicasskop_gke">Multi-Casskop on Google Kubernetes Engine</a></li></ul></div></div><main class="col col--8"><h1>1 post tagged with &quot;sidecars&quot;</h1><a href="/casskop/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/casskop/blog/2020/03/26/dynamics_sidecars_storage">Casskop 0.5.1 - Dynamic sidecars and storage configuration feature</a></h2><div class="margin-vert--md"><time datetime="2020-03-26T00:00:00.000Z" class="blogPostDate_Ta7i">March 26, 2020  Â· 5 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/erdrix" target="_blank" rel="noreferrer noopener"><img src="https://avatars0.githubusercontent.com/u/10503351?s=460&amp;u=ea08d802388c79c17655c314296be58814391572&amp;v=4" alt="Alexandre Guitton"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/erdrix" target="_blank" rel="noreferrer noopener">Alexandre Guitton</a></h4><small class="avatar__subtitle">Alexandre Guitton</small></div></div></header><section class="markdown"><p>In a previous post, I was talking about how <a href="/casskop/blog/2020/01/15/multicasskop_gke">Setting up Cassandra Multi-Site on Google Kubernetes Engine with Casskop</a>.
Since then, two new versions <a href="https://github.com/Orange-OpenSource/casskop/releases/tag/v0.5.1-release" target="_blank" rel="noopener noreferrer">0.5.1</a> and <a href="https://github.com/Orange-OpenSource/casskop/releases/tag/v0.5.2-release" target="_blank" rel="noopener noreferrer">0.5.2</a> had been released.
In another post, Cyril Scetbon focused on the <a href="https://medium.com/@cscetbon/new-probes-in-casskop-0-5-1-bfd1d6547967" target="_blank" rel="noopener noreferrer">New Probes feature</a> which was added with the [PR #184Ã˜(<a href="https://github.com/Orange-OpenSource/casskop/pull/184" target="_blank" rel="noopener noreferrer">https://github.com/Orange-OpenSource/casskop/pull/184</a>), in this post I will focus on the dynamic sidecars and storage configurations added to the operator, which give more flexibility to users to configure their Cassandra cluster deployments.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="purposes"></a>Purposes<a class="hash-link" href="#purposes" title="Direct link to heading">#</a></h2><p>During our production migration from bare metal Cassandra Cluster to Kubernetes, the main challenge was to perform the smoothest transition for our OPS teams, allowing them to reuse their homemade tools, to facilitate the cluster operationalization.
However, the operator in this previous form did not leave much room for tuning statefulset and therefore the Cassandra Cluster deployed.
You could use the bootstrap image to customize your cassandra node configuration, but not for the tools revolving around.
That is why we added to the <strong>CassandraCluster</strong> the possibility to define containers into the pod in addition to the cassandra ones, these are the <strong>sidecars</strong>, and to configure extract storage for the pods (ie <strong>VolumeClaimTemplates</strong> to the Statefulset configuration).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="dynamics-sidecars-configurations"></a>Dynamics sidecars configurations<a class="hash-link" href="#dynamics-sidecars-configurations" title="Direct link to heading">#</a></h2><p>To keep the <a href="https://cloud.google.com/blog/products/gcp/7-best-practices-for-building-containers" target="_blank" rel="noopener noreferrer">containerâ€™s best practices</a> and address our OPS needs, we added the ability to define a dynamic list of containers into a <strong>CassandraCluster.Spec</strong> resource definition: <a href="https://github.com/Orange-OpenSource/casskop/blob/master/pkg/apis/db/v1alpha1/cassandracluster_types.go#L803" target="_blank" rel="noopener noreferrer">cassandracluster_types.go#L803</a>.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">sidecarConfigs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tail&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-F&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/var/log/cassandra/system.log&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ez123/alpine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">tini</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cassandra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">log</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 50m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 50Mi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10Mi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /var/log/cassandra</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cassandra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">logs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tail&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-F&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/var/log/cassandra/gc.log.0.current&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ez123/alpine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">tini</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">log</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 50m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 50Mi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10Mi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /var/log/cassandra</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> gc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">logs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>These sidecars are classic <a href="https://godoc.org/k8s.io/api/core/v1#Container" target="_blank" rel="noopener noreferrer">kubernetes container resources</a>, leaving you the full power on what you want to do.
With this example, we add two simple sidecars allowing to distinguish cassandra and GC logs in two different stdout.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>with this feature you can do everything you want, and obviously some bad things. This feature is not here to make a Cassandra Cluster works, the operator has everything for this, but to allow you to simplify some add-ons usage around Cassandra.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="sidecars--environment-variables"></a>Sidecars : environment variables<a class="hash-link" href="#sidecars--environment-variables" title="Direct link to heading">#</a></h2><p>All sidecars added with this configuration will have, at the container init, some of the environment variables from <strong>cassandra container</strong> merged with those defined into the sidecar container</p><ul><li>CASSANDRA_MAX_HEAP</li><li>CASSANDRA_SEEDS</li><li>CASSANDRA_CLUSTER_NAME</li><li>CASSANDRA_GC_STDOUT</li><li>CASSANDRA_NUM_TOKENS</li><li>CASSANDRA_DC</li><li>CASSANDRA_RACK</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="storage-configuration"></a>Storage configuration<a class="hash-link" href="#storage-configuration" title="Direct link to heading">#</a></h2><p>In the previous version, the only option about storage was the <a href="/casskop/docs/3_configuration_deployment/3_storage">data volume configuration</a> allowing you to define :</p><ul><li><code>dataCapacity</code>: Defines the size of the persistent volume claim, for example, &quot;1000Gi&quot;.</li><li><code>dataStorageClass</code>: Defines the type of storage to use (or use default one). We recommend to use local-storage for better performances but it can be any storage with high ssd throughput.</li></ul><p>The dynamic sidecar doesnâ€™t really suit, unless you put everything in one folder.</p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Spoiler alert</h5></div><div class="admonition-content"><p>Itâ€™s not a good idea</p></div></div><p>That is why we add the <code>CassandraCluster.Spec.StorageConfig</code> field, to the <code>CassandraCluster</code> resource definition :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token key atrule">storageConfigs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/var/lib/cassandra/log&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;gc-logs&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token key atrule">pvcSpec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">storageClassName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> local</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">storage</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 5Gi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/var/log/cassandra&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cassandra-logs&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token key atrule">pvcSpec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token key atrule">storageClassName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> local</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">storage</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10Gi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>storageConfigs</code> : Defines the list of storage config object, which will instantiate <code>Persitence Volume Claim</code> and associate volume to pod of cassandra node.</p><ul><li><code>mountPath</code>: Defines the path into cassandra container where the volume will be mounted.</li><li><code>name</code>: Used to define the PVC and VolumeMount names.</li><li><code>pvcSpec</code>: pvcSpec describes the PVC used for the mountPath described above, it requires a kubernetes PVC spec.</li></ul><p>In this example, we add the two volumes required by our sidecars previously configured, to be able via the sidecars to access to the logs that we want to expose on the stdout.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="volume-claim-template-and-statefulset"></a>Volume Claim Template and statefulset<a class="hash-link" href="#volume-claim-template-and-statefulset" title="Direct link to heading">#</a></h2><p>Keep in mind that Casskop operator works on Statefulset, but have some constraints such as :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-log codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">updates to statefulset spec for fields other than &#x27;replicas&#x27;, &#x27;template&#x27;, and &#x27;updateStrategy&#x27; are forbidden.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>So if you want to add or remove some storages configurations, today you have to perform manually it, by removing the Statefulset, which will be recreated by the operator.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Itâ€™s not a sake operation, and should be performed carefully, because you will loose a rack. Maybe in some releases we will manage it, but today we assume that this operation is an exceptional one.</p></div></div><p><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer">CassKop</a> is open source so donâ€™t hesitate to try it out, contribute by first trying to fix a discovered issue and letâ€™s enhance it together!</p><p>In a next post, I will speak about the IP management into Casskop, and the <a href="https://github.com/Orange-OpenSource/casskop/issues/170" target="_blank" rel="noopener noreferrer">cross IPs issue</a>, so stay connected !</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/casskop/blog/tags/casskop">casskop</a><a class="margin-horiz--sm" href="/casskop/blog/tags/cassandra">cassandra</a><a class="margin-horiz--sm" href="/casskop/blog/tags/0-5-2">0.5.2</a><a class="margin-horiz--sm" href="/casskop/blog/tags/sidecars">sidecars</a><a class="margin-horiz--sm" href="/casskop/blog/tags/storage">storage</a></div><div class="col text--right"><a aria-label="Read more about Casskop 0.5.1 - Dynamic sidecars and storage configuration feature" href="/casskop/blog/2020/03/26/dynamics_sidecars_storage"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Getting Started</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/casskop/docs/1_concepts/1_introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/Orange-OpenSource/casskop" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://casskop.slack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a class="footer__link-item" href="/casskop/blog">Blog</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contact</h4><ul class="footer__items"><li class="footer__item"><a href="mailto:prj.casskop.support@list.orangeportails.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email</a></li><li class="footer__item"><a href="https://github.com/Orange-OpenSource/casskop/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Feature request</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 Orange, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/casskop/styles.e109d7ba.js"></script>
<script src="/casskop/runtime~main.8734032c.js"></script>
<script src="/casskop/main.0dba0698.js"></script>
<script src="/casskop/1.609d1f21.js"></script>
<script src="/casskop/2.9fbf0449.js"></script>
<script src="/casskop/3.3079f6c6.js"></script>
<script src="/casskop/6875c492.674c6f13.js"></script>
<script src="/casskop/e0f41929.8c9ab0c8.js"></script>
<script src="/casskop/902ac59e.365b93f1.js"></script>
<script src="/casskop/6dd645a8.884a5509.js"></script>
</body>
</html>